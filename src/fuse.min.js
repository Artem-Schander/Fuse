/**
 * @license
 * Fuse - Lightweight fuzzy-search
 *
 * Copyright (c) 2012-2016 Kirollos Risk <kirollos@gmail.com>.
 * All Rights Reserved. Apache Software License 2.0
 *
 * Licensed under the Apache License, Version 2.0 (the "License")
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(t){"use strict";function e(){console.log.apply(console,arguments)}function s(t,e){var s,o,i,n;for(t.constructor===Array?this["typeof"]="array":this["typeof"]=typeof t,"object"===this["typeof"]&&(t=Object.keys(t).map(function(e){var s=t[e];return s.__o_key=e,s})),this.list=t,this.options=e=e||{},s=0,n=["sort","shouldSort","verbose","tokenize"],o=n.length;o>s;s++)i=n[s],this.options[i]=i in e?e[i]:h[i];for(s=0,n=["searchFn","sortFn","keys","getFn","include"],o=n.length;o>s;s++)i=n[s],this.options[i]=e[i]||h[i]}function o(t,e,s){var n,r,h,a,c,p;if(e){if(h=e.indexOf("."),-1!==h?(n=e.slice(0,h),r=e.slice(h+1)):n=e,a=t[n],null!==a&&void 0!==a)if(r||"string"!=typeof a&&"number"!=typeof a)if(i(a))for(c=0,p=a.length;p>c;c++)o(a[c],r,s);else r&&o(a,r,s);else s.push(a)}else s.push(t);return s}function i(t){return"[object Array]"===Object.prototype.toString.call(t)}function n(t,e){e=e||{},this.options=e,this.options.location=e.location||n.defaultOptions.location,this.options.distance="distance"in e?e.distance:n.defaultOptions.distance,this.options.threshold="threshold"in e?e.threshold:n.defaultOptions.threshold,this.options.maxPatternLength=e.maxPatternLength||n.defaultOptions.maxPatternLength,this.pattern=e.caseSensitive?t:t.toLowerCase(),this.patternLen=t.length,this.patternLen<=this.options.maxPatternLength&&(this.matchmask=1<<this.patternLen-1,this.patternAlphabet=this._calculatePatternAlphabet())}var r=/ +/g,h={id:null,caseSensitive:!1,include:[],shouldSort:!0,searchFn:n,sortFn:function(t,e){return t.score-e.score},getFn:o,keys:[],verbose:!1,tokenize:!1};s.VERSION="2.2.0",s.prototype.set=function(t){return this.list=t,t},s.prototype.search=function(t){this.options.verbose&&e("\nSearch term:",t,"\n"),this.pattern=t,this.results=[],this.resultMap={},this._keyMap=null,this._prepareSearchers(),this._startSearch(),this._computeScore(),this._sort();var s=this._format();return s},s.prototype._prepareSearchers=function(){var t=this.options,e=this.pattern,s=t.searchFn,o=e.split(r),i=0,n=o.length;if(this.options.tokenize)for(this.tokenSearchers=[];n>i;i++)this.tokenSearchers.push(new s(o[i],t));this.fullSeacher=new s(e,t)},s.prototype._startSearch=function(){var t,e,s,o,i=this.options,n=i.getFn,r=this.list,h=r.length,a=this.options.keys,c=a.length,p=null;if("string"==typeof r[0])for(s=0;h>s;s++)this._analyze("",r[s],s,s);else for(this._keyMap={},s=0;h>s;s++)for(p=r[s],o=0;c>o;o++){if(t=a[o],"string"!=typeof t){if(e=1-t.weight||1,this._keyMap[t.name]={weight:e},t.weight<=0||t.weight>1)throw new Error("Key weight has to be > 0 and <= 1");t=t.name}else this._keyMap[t]={weight:1};this._analyze(t,n(p,t,[]),p,s)}},s.prototype._analyze=function(t,s,o,n){var h,a,c,p,l,f,u,d,y,g,m,_,v,b,k,S=this.options,M=!1;if(void 0!==s&&null!==s)if(a=[],"string"==typeof s){if(h=s.split(r),S.verbose&&e("---------\nKey:",t),S.verbose&&e("Record:",h),this.options.tokenize){for(c=this.tokenSearchers,p=c.length,b=0;b<this.tokenSearchers.length;b++){for(g=this.tokenSearchers[b],m=[],k=0;k<h.length;k++)_=h[k],v=g.search(_),v.isMatch?(M=!0,m.push(v.score),a.push(v.score)):(m.push(1),a.push(1));S.verbose&&e("Token scores:",m)}for(f=a[0],d=a.length,b=1;d>b;b++)f+=a[b];f/=d,S.verbose&&e("Token score average:",f)}y=this.fullSeacher.search(s),S.verbose&&e("Full text score:",y.score),u=y.score,void 0!==f&&(u=(u+f)/2),S.verbose&&e("Score average:",u),(M||y.isMatch)&&(l=this.resultMap[n],l?l.output.push({key:t,score:u,matchedIndices:y.matchedIndices}):(this.resultMap[n]={item:o,output:[{key:t,score:u,matchedIndices:y.matchedIndices}]},this.results.push(this.resultMap[n])))}else if(i(s))for(b=0;b<s.length;b++)this._analyze(t,s[b],o,n)},s.prototype._computeScore=function(){var t,s,o,i,n,r,h,a,c,p=this._keyMap,l=this.results;for(this.options.verbose&&e("\n\nComputing score:\n"),t=0;t<l.length;t++){for(o=0,i=l[t].output,n=i.length,a=1,s=0;n>s;s++)r=i[s].score,h=p?p[i[s].key].weight:1,c=r*h,1!==h?a=Math.min(a,c):(o+=c,i[s].nScore=c);1===a?l[t].score=o/n:l[t].score=a,this.options.verbose&&e(l[t])}},s.prototype._sort=function(){var t=this.options;t.shouldSort&&(t.verbose&&e("\n\nSorting...."),this.results.sort(t.sortFn))},s.prototype._format=function(){var t,s,o,i,n,r=this.options,h=r.getFn,a=this.results,c=r.include,p=this["typeof"];if(r.verbose&&e("\n\nOutput:\n\n",a),i=r.id?function(t){"object"===p&&"key"===r.id?a[t].item=a[t].item.__o_key:a[t].item=h(a[t].item,r.id,[])[0]}:function(){},n=function(t){var e,s,o,i,n,r=a[t];if(c.length>0){if(e={item:r.item},-1!==c.indexOf("matches"))for(o=r.output,e.matches=[],s=0;s<o.length;s++)i=o[s],n={indices:i.matchedIndices},i.key&&(n.key=i.key),e.matches.push(n);-1!==c.indexOf("score")&&(e.score=a[t].score)}else e=r.item;return e},"array"===this["typeof"]){var l=[];for(s=0,o=a.length;o>s;s++)i(s),t=n(s),l.push(t)}else if("object"===this["typeof"]){var l=r.id?[]:{};for(s=0,o=a.length;o>s;s++)i(s),t=n(s),"object"==typeof t?(l[t.__o_key]=t,delete l[t.__o_key].__o_key):l.push(t)}return l},n.defaultOptions={location:0,distance:100,threshold:.6,maxPatternLength:32},n.prototype._calculatePatternAlphabet=function(){var t={},e=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]=0;for(e=0;e<this.patternLen;e++)t[this.pattern.charAt(e)]|=1<<this.pattern.length-e-1;return t},n.prototype._bitapScore=function(t,e){var s=t/this.patternLen,o=Math.abs(this.options.location-e);return this.options.distance?s+o/this.options.distance:o?1:s},n.prototype.search=function(t){var e,s,o,i,n,h,a,c,p,l,f,u,d,y,g,m,_,v,b,k,S,M,L=this.options;if(t=L.caseSensitive?t:t.toLowerCase(),this.pattern===t)return{isMatch:!0,score:0,matchedIndices:[[0,t.length-1]]};if(this.patternLen>L.maxPatternLength){if(_=t.match(new RegExp(this.pattern.replace(r,"|"))),v=!!_)for(k=[],e=0,S=_.length;S>e;e++)M=_[e],k.push([t.indexOf(M),M.length-1]);return{isMatch:v,score:v?.5:1,matchedIndices:k}}for(i=L.location,o=t.length,n=L.threshold,h=t.indexOf(this.pattern,i),b=[],e=0;o>e;e++)b[e]=0;for(-1!=h&&(n=Math.min(this._bitapScore(0,h),n),h=t.lastIndexOf(this.pattern,i+this.patternLen),-1!=h&&(n=Math.min(this._bitapScore(0,h),n))),h=-1,g=1,m=[],p=this.patternLen+o,e=0;e<this.patternLen;e++){for(a=0,c=p;c>a;)this._bitapScore(e,i+c)<=n?a=c:p=c,c=Math.floor((p-a)/2+a);for(p=c,l=Math.max(1,i-c+1),f=Math.min(i+c,o)+this.patternLen,u=Array(f+2),u[f+1]=(1<<e)-1,s=f;s>=l;s--)if(y=this.patternAlphabet[t.charAt(s-1)],y&&(b[s-1]=1),0===e?u[s]=(u[s+1]<<1|1)&y:u[s]=(u[s+1]<<1|1)&y|((d[s+1]|d[s])<<1|1)|d[s+1],u[s]&this.matchmask&&(g=this._bitapScore(e,s-1),n>=g)){if(n=g,h=s-1,m.push(h),!(h>i))break;l=Math.max(1,2*i-h)}if(this._bitapScore(e+1,i)>n)break;d=u}return k=this._getMatchedIndices(b),{isMatch:h>=0,score:0===g?.001:g,matchedIndices:k}},n.prototype._getMatchedIndices=function(t){for(var e,s=[],o=-1,i=-1,n=0,r=r=t.length;r>n;n++)e=t[n],e&&-1===o?o=n:e||-1===o||(i=n-1,s.push([o,i]),o=-1);return t[n-1]&&s.push([o,n-1]),s},"object"==typeof exports?module.exports=s:"function"==typeof define&&define.amd?define(function(){return s}):t.Fuse=s}(this);